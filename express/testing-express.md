# Jest & Supertest for Express Server

## Setting up testing for a node-express server
*The following code assumes you're starting with a fresh server generated by express-generator. Modify any code snippet accordingly for different server setup.*

1. Add dependencies:

```
npm install --save-dev jest supertest
```

2. In the **package.json** add the code below:

```js
"jest": {
    "testEnvironment": "node",
    "coveragePathIgnorePatterns": [
        "/node_modules/"
    ]
},
```

3. and inside **scripts**:

```js
"test": "jest"
```

4. add a new file ```sample.test.js``` and add the code:

```js
describe('Sample Test', () => {
  it('should test that true === true', () => {
    expect(true).toBe(true)
  })
})
```

5. and run ```npm test``` to make sure it's working (*the test should pass*)

6. Instal ```cross-env``` to set test env variable and timeout
```
npm i -D cross-env
```

7. modify the **scripts** in **package.json**:

```js
"scripts": {
    "start-dev": "nodemon index.js",
     "test": "cross-env NODE_ENV=test jest --testTimeout=10000"
  }

```

8. test again with ```npm test``` to make sure nothing is broken

9. create a file called **routes.test.js** inside the tests folder and copy/modify the following code to test a route:

```js
const request = require('supertest')
const app = require('../app')
describe('Get Users Listsings', () => {
  it('respond with a string', async () => {
    const res = await request(app)
      .get('/users')
    .expect(200)
  })
})
```

